<%= link_to 'Back', candidates_schools_path, class: 'govuk-back-link' %>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-l">School experience placements <%= describe_current_search @search %></h1>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third filter-list" id="search-filter">
        <%= form_for @search, as: '', method: :get, data: {controller:'instant-filter'} do |f| %>
            <%= f.hidden_field :query %>
            <%= f.hidden_field :location %>
            <%= f.hidden_field :distance %>

            <%= f.collection_check_boxes :phases, Candidates::School.phases, :first, :last %>

            <%= f.radio_button_fieldset :max_fee, choices: Candidates::SchoolSearch.fees,
                                                    value_method: :first,
                                                    text_method: :last %>

            <%= f.collection_check_boxes :subjects, Candidates::School.subjects, :first, :last %>
            <%= f.hidden_field :order %>

            <%= f.submit 'Update schools list', name: nil %>
        <% end %>
    </div>

    <div class="govuk-grid-column-two-thirds" id="search-results">

        <div class="pagination-info higher">
          <div class="pagination-slice">
            <%= school_results_info @search %>
          </div>

          <%= paginate @search.results %>
        </div>

        <hr />

        <div class="sortby inline-fields">
            <%= form_for @search, as: '', method: :get, data: {controller:'instant-filter'} do |f| %>
                <%= f.hidden_field :query %>
                <%= f.hidden_field :location %>
                <%= f.hidden_field :distance %>
                <% for phase_id in f.object.phases %>
                    <%= f.hidden_field :phases, multiple: true, value: phase_id, id: nil %>
                <% end %>
                <% for subject_id in f.object.subjects %>
                    <%= f.hidden_field :subjects, multiple: true, value: subject_id, id: nil %>
                <% end %>
                <%= f.hidden_field :max_fee %>
                <%= f.collection_select :order, f.object.class.available_orders, :first, :last %>
                <%= f.submit "Change sort order", name: nil %>
            <% end %>
        </div>

        <hr />

        <ul id="results">
            <% @search.results.each_with_index do |result, index| %>
            <li class="school-result" data-school-urn="<%= result.urn %>">
                <strong class="name"><%= link_to result.name, candidates_school_path(result) %></strong>
                <ul>
                    <li><strong>Address:</strong> <%= format_school_address result %></li>
                    <li><strong>Education phase:</strong> <%= format_school_phases result %></li>
                    <li><strong>Fees:</strong> &pound;<%= result.fee %></li>
                    <li><strong>School type:</strong> <%= result.school_type&.name %></li>
                    <li><strong>Subjects:</strong> <%= format_school_subjects result %></li>
                </ul>
            </li>
            <% end %>
        </ul>

        <%- if show_lower_navigation?(@search.results.length) %>
          <div class="pagination-info lower">
            <%= paginate @search.results %>
          </div>
        <% end %>
    </div>
</div>
